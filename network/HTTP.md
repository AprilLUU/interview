## HTTP

应用层的传输协议，无连接无状态，明文传输

HTTP不安全，明文传输，内容可能被窃听，不校验身份，可以遭遇伪装，无法验证报文完整性

### 1. 状态码

1xx 中间状态，需要后续操作

- 101 Switching Protocols，协议升级，切换到WebSocket

2xx 成功响应

- 200 OK 响应成功
- 201 Created 请求成功并创建了新的资源，常用于POST请求
- 204 Not Content 浏览器在处理复杂请求时发送的预检请求返回的响应码

3xx 重定向

- 301 Moved Permanently 永久重定向
- 302 Found 临时重定向
- 304 Not Modified 协商缓存

4xx 客户端错误

- 400 Bad Request 请求错误 通常是参数错误
- 401 Unauthorized 请求需要身份验证，没提供有效凭证token
- 403 Forbidden 无权限访问

- 404 Not Found 没找到资源

5xx 服务器端错误

- 500 服务器无法处理请求

### 2. HTTP缓存

强缓存 

- Cache-Control 
- Expries

协商缓存 

- Etag 
- If-None-Match 
- Last-Modified 
- If-Modified-Since

### 3. HTTP版本

#### HTTP1.0 

- 短链接，每次请求都需要建立TCP连接

#### HTTP1.1 

- 持久连接，建立TCP连接之后可以复用
- 流水线方式，一次可以发送多个请求，服务器必须按请求的先后到达顺序依次进行处理，存在响应的队头阻塞

#### HTTP2 

- 基于HTTPS，可以保障安全

对HTTP1.1的改进 

1. **头部压缩**，对多个请求的相同头部进行压缩， `HPACK` 算法：在客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，以后就不发送同样字段了，只发送索引号，这样就提高速度了 
2. 采用**二进制格式**， 不再是纯文本的传输，头部信息和数据体都是二进制，并且统称为帧（frame）：**头信息帧（Headers Frame）和数据帧（Data Frame）**。  直接解析二进制报文，这**增加了数据传输的效率**
3. **多路复用**，一个TCP连接可以并发多个请求和响应，解决HTTP1.1响应队头阻塞
4. 允许服务端主动推送数据

#### HTTP3

HTTP2解决应用层的队头阻塞，但由于TCP需要保证可靠传输，当出现丢包的情况，需要等待丢失的数据到达再处理后面的数据，因此在传输层仍然存在队头阻塞。

- 为了解决TCP队头阻塞，HTTP3传输层采用UDP，并在应用层（QUIC）实现TCP可靠的传输机制（超时重传，流量控制，拥塞控制）

- 由于TCP基于四元组（IP和端口号）进行传输，在切换网络时需要重新建立TCP连接，而QUIC使用Connection ID标识一个连接，只要ID不变，就可以达到0RTT的连接建立。

### 4. HTTPS

在HTTP和TCP加入一层SSL/TSL协议进行加密传输

- 信息加密，采用混合加密的方式对数据进行加密传输

- 校验机制，采用摘要算法生成唯一的指纹用于校验，保证数据完整性

- 身份证书，需要到CA申请数字证书，将服务器公钥放入数字证书中，进行身份校验

- 对称加密，加密解密都是采用同一个密钥

- 非对称加密，用公钥进行加密，私钥进行加密

#### SSL/TSL通信过程（4次握手）

1. 客户端发起加密通信请求，TSL版本，加密算法，随机数

2. 服务器收到请求，确认TSL版本和加密算法，返回随机数和数字证书

3. 客户端收到证书，通过CA验证证书可靠性，拿到服务器的公钥，再次生成一个随机数，通过服务器公钥加密，发送给服务端

4. 服务器通过私钥解密得到随机数，随后双方都得到三个随机数，这三个随机数加密之后就是通信的密钥

![](./images/HTTPS.png)

### 5. HTTP报文

#### 请求报文

- 请求行  请求方法 请求资源 HTTP版本信息
- 请求头
- 空行 区别请求头和请求体
- 请求体，传文件**multipart/form-data**，JSON数据**applocation/json**，XML数据**applocation/xml**，文本数据**text/plain**，表单数据**application/x-www-form-urlencoded**

### 6. 请求方法

#### GET，POST区别

- GET通常用来获取资源，POST可能对服务器资源进行修改
- GET通过URL查询传递参数，长度受限，POST参数在请求体中传递
- 明文传输，都不安全，GET的参数在URL中更显而易见

#### PUT，PATCH

- PUT更新资源，PATCH更新部分资源

#### DELETE

- DELETE删除资源

#### OPTIONS

- 浏览器预检请求，判断服务器是否支持跨域资源共享

#### HEAD

- 获取资源元信息，只返回响应头，不返回响应体